(()=>{var e={};e.id=362,e.ids=[362],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1851:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>c}),s(4747),s(4968),s(5866);var r=s(3191),a=s(8716),n=s(7922),i=s.n(n),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["dashboard",{children:["agent",{children:["ticket",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4747)),"/root/webhook/ticket-console/src/app/dashboard/agent/ticket/[id]/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,4968)),"/root/webhook/ticket-console/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/root/webhook/ticket-console/src/app/dashboard/agent/ticket/[id]/page.tsx"],x="/dashboard/agent/ticket/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/agent/ticket/[id]/page",pathname:"/dashboard/agent/ticket/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9859:(e,t,s)=>{Promise.resolve().then(s.bind(s,5884))},361:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(2881).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5884:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(326),a=s(8853),n=s(5047),i=s(7577),l=s(8069),d=s(273),c=s(9179),o=s(9852),x=s(6333),u=s(361),m=s(5804),g=s(3686);let p={Low:"bg-gray-100 text-gray-700",Medium:"bg-blue-100 text-blue-700",High:"bg-orange-100 text-orange-700",Critical:"bg-red-100 text-red-700"},h={Open:"bg-yellow-100 text-yellow-700","In Progress":"bg-blue-100 text-blue-700","Awaiting Customer":"bg-purple-100 text-purple-700",Escalated:"bg-orange-100 text-orange-700",Resolved:"bg-green-100 text-green-700",Closed:"bg-gray-100 text-gray-700"};function b(){let{user:e,isLoading:t}=(0,a.a)(),s=parseInt((0,n.useParams)().id),[b,f]=(0,i.useState)(null),[j,y]=(0,i.useState)([]),[v,w]=(0,i.useState)(""),[N,k]=(0,i.useState)(!0),[_,C]=(0,i.useState)(!1),T=(0,i.useRef)(null);(0,i.useRef)(0),(0,c.r)(j,e?.id,"agent");let A=(0,i.useCallback)(async()=>{if(e?.id&&s)try{let t=await l.fb.getTicketDetails(s,e.id);f(t)}catch(e){console.error("Error loading ticket:",e)}},[e?.id,s]),P=(0,i.useCallback)(async()=>{if(e?.id&&s)try{console.log("[Chat] Loading messages for ticket:",s);let t=await l.fb.getTicketMessages(s,e.id);y(t)}catch(e){console.error("Error loading messages:",e)}},[e?.id,s]),R=(0,i.useCallback)(async()=>{try{k(!0),await Promise.all([A(),P()])}finally{k(!1)}},[A,P]);(0,d.sU)(s,A,P);let M=async()=>{if(v.trim()&&!_)try{C(!0),await l.fb.addMessage(s,e.id,v),w(""),R()}catch(e){console.error("Error sending message:",e)}finally{C(!1)}},S=async t=>{try{await l.fb.updateTicketStatus(s,e.id,t),R()}catch(e){console.error("Error updating status:",e)}},$=async()=>{await S(5)};if(t||!e)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."});if(N)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading ticket..."});if(!b)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-500 mb-4",children:"Ticket not found or you don't have access"}),r.jsx("button",{onClick:()=>window.history.back(),className:"text-green-600 hover:text-green-700",children:"Go back"})]})});let E=b.status?.name||"Unknown",q=b.priority?.name||"Medium",U=["Resolved","Closed"].includes(E);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[r.jsx("header",{className:"bg-green-600 text-white shrink-0",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[(0,r.jsxs)("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 text-green-200 hover:text-white mb-3",children:[r.jsx(x.Z,{className:"w-4 h-4"}),"Back to dashboard"]}),(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"text-sm text-green-200",children:["#",b.ticket_id]}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${h[E]}`,children:E}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p[q]}`,children:q})]}),r.jsx("h1",{className:"text-xl font-bold",children:b.subject})]}),!U&&(0,r.jsxs)("button",{onClick:$,className:"flex items-center gap-2 bg-green-500 hover:bg-green-400 px-4 py-2 rounded-lg text-sm",children:[r.jsx(u.Z,{className:"w-4 h-4"}),"Mark Resolved"]})]})]})}),r.jsx("div",{className:"bg-white border-b border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Contact"}),r.jsx("p",{className:"font-medium",children:b.contact?.full_name}),r.jsx("p",{className:"text-gray-400",children:b.contact?.phone})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Organization"}),r.jsx("p",{className:"font-medium",children:b.organization?.name})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Created"}),r.jsx("p",{className:"font-medium",children:(0,m.WU)(new Date(b.created_at),"MMM d, yyyy")}),r.jsx("p",{className:"text-gray-400",children:(0,g.Q)(new Date(b.created_at),{addSuffix:!0})})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Update Status"}),(0,r.jsxs)("select",{value:b.status_id,onChange:e=>S(parseInt(e.target.value)),disabled:U,className:"mt-1 block w-full border border-gray-300 rounded-lg px-3 py-1.5 text-sm disabled:bg-gray-100",children:[r.jsx("option",{value:1,children:"Open"}),r.jsx("option",{value:2,children:"In Progress"}),r.jsx("option",{value:3,children:"Awaiting Customer"}),r.jsx("option",{value:4,children:"Escalated"}),r.jsx("option",{value:5,children:"Resolved"}),r.jsx("option",{value:6,children:"Closed"})]})]})]}),b.description&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[r.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),r.jsx("p",{className:"text-gray-700",children:b.description})]})]})}),r.jsx("div",{className:"flex-1 overflow-auto bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Conversation"}),r.jsx(o.uU,{messages:j,currentUserId:e.id,userRole:"agent",messagesEndRef:T,emptyMessage:"No messages yet. Start the conversation below."})]})}),!U&&r.jsx("div",{className:"bg-white border-t border-gray-200 shrink-0 shadow-lg",children:r.jsx("div",{className:"max-w-5xl mx-auto px-4 py-4",children:r.jsx(o.xg,{value:v,onChange:w,onSend:M,sending:_,placeholder:"Type your response...",accentColor:"green"})})}),U&&r.jsx("div",{className:"bg-gray-100 border-t border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-4 text-center text-gray-500",children:["This ticket is ",E.toLowerCase(),"."]})})]})}},9852:(e,t,s)=>{"use strict";s.d(t,{uU:()=>c,xg:()=>o});var r=s(326),a=s(732),n=s(9635),i=s(7506),l=s(5804);function d({message:e,currentUserId:t,userRole:s}){let i=!!e.sender_agent_id,d=i&&e.sender_agent?.agent_type==="Bot",c="requester"===s?e.sender_contact_id===t:e.sender_agent_id===t,o=c?"You":i?e.sender_agent?.full_name||"Support Agent":e.sender_contact?.full_name||"Customer",x=()=>d?"text-purple-600":i?"text-green-600":"text-blue-600";return(0,r.jsxs)("div",{className:`flex gap-3 ${c?"flex-row-reverse":""}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm ${d?"bg-purple-100":i?"bg-green-100":"bg-blue-100"}`,children:d?r.jsx(a.Z,{className:`w-5 h-5 ${x()}`}):r.jsx(n.Z,{className:`w-5 h-5 ${x()}`})}),(0,r.jsxs)("div",{className:`flex flex-col max-w-[75%] ${c?"items-end":"items-start"}`,children:[(0,r.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${c?"flex-row-reverse":""}`,children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:o}),r.jsx("span",{className:"text-xs text-gray-400",children:(0,l.WU)(new Date(e.message_time),"MMM d, h:mm a")}),d&&r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:`rounded-2xl px-4 py-2.5 shadow-sm ${c?"requester"===s?"bg-blue-600 text-white":"agent"===s?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-white border border-gray-200 text-gray-700"} ${c?"rounded-tr-sm":"rounded-tl-sm"}`,children:r.jsx("div",{className:"whitespace-pre-wrap break-words leading-relaxed",children:d?function(e){let t=[],s=0;return e.split("\n").forEach((e,a)=>{let n;a>0&&t.push(r.jsx("br",{},`br-${s++}`));let i=[],l=0,d=/\*\*(.+?)\*\*|__(.+?)__/g;for(;null!==(n=d.exec(e));){n.index>l&&i.push(e.substring(l,n.index));let t=n[1]||n[2];i.push(r.jsx("strong",{className:"font-semibold",children:t},`bold-${s++}`)),l=n.index+n[0].length}l<e.length&&i.push(e.substring(l)),0===i.length?t.push(e):t.push(...i)}),t}(e.content):e.content})})]})]})}function c({messages:e,currentUserId:t,userRole:s,messagesEndRef:l,emptyMessage:c="No messages yet. Start the conversation below.",aiThinking:o=!1}){return 0===e.length?r.jsx("div",{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(n.Z,{className:"w-8 h-8 text-gray-400"})}),r.jsx("p",{className:"text-gray-500",children:c})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[e.map(e=>r.jsx(d,{message:e,currentUserId:t,userRole:s},e.message_id)),o&&(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm bg-purple-100",children:r.jsx(a.Z,{className:"w-5 h-5 text-purple-600"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"AI Assistant"}),r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:"rounded-2xl rounded-tl-sm px-4 py-3 bg-white border border-gray-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[r.jsx(i.Z,{className:"w-4 h-4 animate-spin text-purple-600"}),r.jsx("span",{className:"text-sm",children:"AI is thinking..."})]})})]})]}),r.jsx("div",{ref:l})]})}function o({value:e,onChange:t,onSend:s,sending:a,placeholder:n="Type your message...",accentColor:i="blue"}){let l={blue:{focus:"focus:ring-blue-500 focus:border-blue-500",button:"bg-blue-600 hover:bg-blue-700"},green:{focus:"focus:ring-green-500 focus:border-green-500",button:"bg-green-600 hover:bg-green-700"},purple:{focus:"focus:ring-purple-500 focus:border-purple-500",button:"bg-purple-600 hover:bg-purple-700"}}[i];return(0,r.jsxs)("div",{className:"flex gap-3 items-end",children:[r.jsx("div",{className:"flex-1 relative",children:r.jsx("textarea",{value:e,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())},placeholder:n,rows:1,className:`w-full px-4 py-3 border border-gray-300 rounded-xl resize-none ${l.focus} focus:ring-2 transition-shadow`,style:{minHeight:"48px",maxHeight:"120px"}})}),r.jsx("button",{onClick:s,disabled:!e.trim()||a,className:`p-3 ${l.button} text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm`,children:a?r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}},9179:(e,t,s)=>{"use strict";s.d(t,{r:()=>a});var r=s(7577);function a(e,t,s){let{playNotificationSound:a}=function(){let e=(0,r.useRef)(null),t=(0,r.useRef)(0);return{playNotificationSound:(0,r.useCallback)(()=>{let s=Date.now();if(!(s-t.current<1e3)){t.current=s;try{e.current||(e.current=new(window.AudioContext||window.webkitAudioContext));let t=e.current;"suspended"===t.state&&t.resume();let s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.setValueAtTime(880,t.currentTime),s.frequency.setValueAtTime(1047,t.currentTime+.1),s.type="sine",r.gain.setValueAtTime(0,t.currentTime),r.gain.linearRampToValueAtTime(.3,t.currentTime+.05),r.gain.linearRampToValueAtTime(.2,t.currentTime+.1),r.gain.linearRampToValueAtTime(.3,t.currentTime+.15),r.gain.linearRampToValueAtTime(0,t.currentTime+.3),s.start(t.currentTime),s.stop(t.currentTime+.3)}catch(e){console.log("[NotificationSound] Audio not available:",e)}}},[])}}();(0,r.useRef)(0),(0,r.useRef)(new Set),(0,r.useRef)(!0)}},4747:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/root/webhook/ticket-console/src/app/dashboard/agent/ticket/[id]/page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,347,444,514,721],()=>s(1851));module.exports=r})();