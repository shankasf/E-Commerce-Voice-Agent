(()=>{var e={};e.id=87,e.ids=[87],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},903:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>d}),t(1),t(4968),t(5866);var r=t(3191),a=t(8716),l=t(7922),n=t.n(l),i=t(5231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);t.d(s,c);let d=["",{children:["dashboard",{children:["admin",{children:["ticket",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1)),"/root/webhook/ticket-console/src/app/dashboard/admin/ticket/[id]/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4968)),"/root/webhook/ticket-console/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/root/webhook/ticket-console/src/app/dashboard/admin/ticket/[id]/page.tsx"],x="/dashboard/admin/ticket/[id]/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/admin/ticket/[id]/page",pathname:"/dashboard/admin/ticket/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9311:(e,s,t)=>{Promise.resolve().then(t.bind(t,6567))},6567:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>v});var r=t(326),a=t(8853),l=t(5047),n=t(7577),i=t(8069),c=t(273),d=t(9179),o=t(9852),x=t(6333),u=t(732),m=t(2881);let p=(0,m.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),g=(0,m.Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var h=t(9635),b=t(5804),f=t(3686);let y={Low:"bg-gray-100 text-gray-700",Medium:"bg-blue-100 text-blue-700",High:"bg-orange-100 text-orange-700",Critical:"bg-red-100 text-red-700"},j={Open:"bg-yellow-100 text-yellow-700","In Progress":"bg-blue-100 text-blue-700","Awaiting Customer":"bg-purple-100 text-purple-700",Escalated:"bg-orange-100 text-orange-700",Resolved:"bg-green-100 text-green-700",Closed:"bg-gray-100 text-gray-700"};function v(){let{user:e,isLoading:s}=(0,a.a)(),t=parseInt((0,l.useParams)().id),[m,v]=(0,n.useState)(null),[N,w]=(0,n.useState)([]),[k,_]=(0,n.useState)([]),[A,C]=(0,n.useState)(!0),[T,S]=(0,n.useState)(!1),[M,P]=(0,n.useState)(null),[I,R]=(0,n.useState)(!1),[E,$]=(0,n.useState)(!1),D=(0,n.useRef)(null);(0,n.useRef)(0),(0,d.r)(N,e?.id,"admin");let q=(0,n.useCallback)(async()=>{if(t)try{let e=await i.Sb.getTicketDetails(t);v(e)}catch(e){console.error("Error loading ticket:",e)}},[t]),z=(0,n.useCallback)(async()=>{if(t)try{console.log("[Chat] Loading messages for ticket:",t);let e=await i.Sb.getTicketMessages(t);w(e)}catch(e){console.error("Error loading messages:",e)}},[t]),U=(0,n.useCallback)(async()=>{try{C(!0);let[e,s,r]=await Promise.all([i.Sb.getTicketDetails(t),i.Sb.getTicketMessages(t),i.Sb.getAgents()]);v(e),w(s),_(r.filter(e=>"Human"===e.agent_type))}catch(e){console.error("Error loading ticket:",e)}finally{C(!1)}},[t]);(0,c.sU)(t,q,z);let Z=async e=>{try{await i.Sb.updateTicketStatus(t,e),U()}catch(e){console.error("Error updating status:",e)}},B=async()=>{if(M)try{await i.Sb.assignTicket(t,M),S(!1),P(null),U()}catch(e){console.error("Error assigning ticket:",e)}},H=async()=>{R(!0);try{let e=await i.Sb.assignAIBot(t);e.success?($(!0),S(!1),U()):(console.error("Failed to assign AI bot:",e.error),alert("Failed to assign AI bot: "+e.error))}catch(e){console.error("Error assigning AI bot:",e)}finally{R(!1)}};if(s||!e)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."});if(A)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading ticket..."});if(!m)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-500 mb-4",children:"Ticket not found"}),r.jsx("button",{onClick:()=>window.history.back(),className:"text-purple-600 hover:text-purple-700",children:"Go back"})]})});let L=m.status?.name||"Unknown",G=m.priority?.name||"Medium";return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[r.jsx("header",{className:"bg-purple-600 text-white shrink-0",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[(0,r.jsxs)("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 text-purple-200 hover:text-white mb-3",children:[r.jsx(x.Z,{className:"w-4 h-4"}),"Back to dashboard"]}),(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"text-sm text-purple-200",children:["#",m.ticket_id]}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${j[L]}`,children:L}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${y[G]}`,children:G}),E&&(0,r.jsxs)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 flex items-center gap-1",children:[r.jsx(u.Z,{className:"w-3 h-3"}),"AI Bot Assigned"]})]}),r.jsx("h1",{className:"text-xl font-bold",children:m.subject})]}),r.jsx("div",{className:"flex gap-2",children:(0,r.jsxs)("button",{onClick:()=>S(!0),className:"flex items-center gap-2 bg-purple-500 hover:bg-purple-400 px-3 py-2 rounded-lg text-sm",children:[r.jsx(p,{className:"w-4 h-4"}),"Assign"]})})]})]})}),r.jsx("div",{className:"bg-white border-b border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Contact"}),r.jsx("p",{className:"font-medium",children:m.contact?.full_name}),r.jsx("p",{className:"text-gray-400",children:m.contact?.email})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Organization"}),r.jsx("p",{className:"font-medium",children:m.organization?.name}),(0,r.jsxs)("p",{className:"text-gray-400",children:["U&E: ",m.organization?.u_e_code]})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Created"}),r.jsx("p",{className:"font-medium",children:(0,b.WU)(new Date(m.created_at),"MMM d, yyyy")}),r.jsx("p",{className:"text-gray-400",children:(0,f.Q)(new Date(m.created_at),{addSuffix:!0})})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Status"}),(0,r.jsxs)("select",{value:m.status_id,onChange:e=>Z(parseInt(e.target.value)),className:"mt-1 block w-full border border-gray-300 rounded-lg px-3 py-1.5 text-sm",children:[r.jsx("option",{value:1,children:"Open"}),r.jsx("option",{value:2,children:"In Progress"}),r.jsx("option",{value:3,children:"Awaiting Customer"}),r.jsx("option",{value:4,children:"Escalated"}),r.jsx("option",{value:5,children:"Resolved"}),r.jsx("option",{value:6,children:"Closed"})]})]})]}),m.description&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[r.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),r.jsx("p",{className:"text-gray-700",children:m.description})]})]})}),r.jsx("div",{className:"flex-1 overflow-auto bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Conversation History"}),r.jsx(o.uU,{messages:N,currentUserId:e.id,userRole:"admin",messagesEndRef:D,emptyMessage:"No messages yet."})]})}),T&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Ticket"}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"\uD83E\uDD16 AI-Powered Resolution"}),(0,r.jsxs)("button",{onClick:H,disabled:I||E,className:`w-full p-4 rounded-lg border text-left flex items-center gap-3 transition-all ${E?"border-green-500 bg-green-50":"border-purple-300 bg-gradient-to-r from-purple-50 to-indigo-50 hover:border-purple-500"} disabled:opacity-50`,children:[r.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-full flex items-center justify-center",children:I?r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx(g,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"font-semibold text-gray-900",children:E?"AI Bot Already Assigned":"Assign AI Support Bot"}),r.jsx("p",{className:"text-sm text-gray-500",children:E?"The AI bot is handling this ticket automatically":"Multi-agent AI will analyze and resolve the issue with step-by-step guidance"})]}),E&&r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Active"})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-2 flex items-center gap-1",children:[r.jsx(g,{className:"w-3 h-3"}),"AI will auto-categorize, provide solutions, and close when resolved"]})]}),r.jsx("div",{className:"border-t border-gray-200 pt-4 mb-2",children:r.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"\uD83D\uDC64 Human Agents"})}),(0,r.jsxs)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[k.map(e=>(0,r.jsxs)("button",{onClick:()=>P(e.support_agent_id),className:`w-full p-3 rounded-lg border text-left flex items-center gap-3 ${M===e.support_agent_id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[r.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx(h.Z,{className:"w-5 h-5 text-green-600"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-gray-900",children:e.full_name}),r.jsx("p",{className:"text-sm text-gray-500",children:e.specialization||"General Support"})]}),e.is_available&&r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Available"})]},e.support_agent_id)),0===k.length&&r.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No human agents available"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200",children:[r.jsx("button",{onClick:()=>{S(!1),P(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-900",children:"Cancel"}),r.jsx("button",{onClick:B,disabled:!M,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:"Assign Human"})]})]})})]})}},9852:(e,s,t)=>{"use strict";t.d(s,{uU:()=>d,xg:()=>o});var r=t(326),a=t(732),l=t(9635),n=t(7506),i=t(5804);function c({message:e,currentUserId:s,userRole:t}){let n=!!e.sender_agent_id,c=n&&e.sender_agent?.agent_type==="Bot",d="requester"===t?e.sender_contact_id===s:e.sender_agent_id===s,o=d?"You":n?e.sender_agent?.full_name||"Support Agent":e.sender_contact?.full_name||"Customer",x=()=>c?"text-purple-600":n?"text-green-600":"text-blue-600";return(0,r.jsxs)("div",{className:`flex gap-3 ${d?"flex-row-reverse":""}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm ${c?"bg-purple-100":n?"bg-green-100":"bg-blue-100"}`,children:c?r.jsx(a.Z,{className:`w-5 h-5 ${x()}`}):r.jsx(l.Z,{className:`w-5 h-5 ${x()}`})}),(0,r.jsxs)("div",{className:`flex flex-col max-w-[75%] ${d?"items-end":"items-start"}`,children:[(0,r.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${d?"flex-row-reverse":""}`,children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:o}),r.jsx("span",{className:"text-xs text-gray-400",children:(0,i.WU)(new Date(e.message_time),"MMM d, h:mm a")}),c&&r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:`rounded-2xl px-4 py-2.5 shadow-sm ${d?"requester"===t?"bg-blue-600 text-white":"agent"===t?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-white border border-gray-200 text-gray-700"} ${d?"rounded-tr-sm":"rounded-tl-sm"}`,children:r.jsx("div",{className:"whitespace-pre-wrap break-words leading-relaxed",children:c?function(e){let s=[],t=0;return e.split("\n").forEach((e,a)=>{let l;a>0&&s.push(r.jsx("br",{},`br-${t++}`));let n=[],i=0,c=/\*\*(.+?)\*\*|__(.+?)__/g;for(;null!==(l=c.exec(e));){l.index>i&&n.push(e.substring(i,l.index));let s=l[1]||l[2];n.push(r.jsx("strong",{className:"font-semibold",children:s},`bold-${t++}`)),i=l.index+l[0].length}i<e.length&&n.push(e.substring(i)),0===n.length?s.push(e):s.push(...n)}),s}(e.content):e.content})})]})]})}function d({messages:e,currentUserId:s,userRole:t,messagesEndRef:i,emptyMessage:d="No messages yet. Start the conversation below.",aiThinking:o=!1}){return 0===e.length?r.jsx("div",{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(l.Z,{className:"w-8 h-8 text-gray-400"})}),r.jsx("p",{className:"text-gray-500",children:d})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[e.map(e=>r.jsx(c,{message:e,currentUserId:s,userRole:t},e.message_id)),o&&(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm bg-purple-100",children:r.jsx(a.Z,{className:"w-5 h-5 text-purple-600"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"AI Assistant"}),r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:"rounded-2xl rounded-tl-sm px-4 py-3 bg-white border border-gray-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[r.jsx(n.Z,{className:"w-4 h-4 animate-spin text-purple-600"}),r.jsx("span",{className:"text-sm",children:"AI is thinking..."})]})})]})]}),r.jsx("div",{ref:i})]})}function o({value:e,onChange:s,onSend:t,sending:a,placeholder:l="Type your message...",accentColor:n="blue"}){let i={blue:{focus:"focus:ring-blue-500 focus:border-blue-500",button:"bg-blue-600 hover:bg-blue-700"},green:{focus:"focus:ring-green-500 focus:border-green-500",button:"bg-green-600 hover:bg-green-700"},purple:{focus:"focus:ring-purple-500 focus:border-purple-500",button:"bg-purple-600 hover:bg-purple-700"}}[n];return(0,r.jsxs)("div",{className:"flex gap-3 items-end",children:[r.jsx("div",{className:"flex-1 relative",children:r.jsx("textarea",{value:e,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t())},placeholder:l,rows:1,className:`w-full px-4 py-3 border border-gray-300 rounded-xl resize-none ${i.focus} focus:ring-2 transition-shadow`,style:{minHeight:"48px",maxHeight:"120px"}})}),r.jsx("button",{onClick:t,disabled:!e.trim()||a,className:`p-3 ${i.button} text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm`,children:a?r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}},9179:(e,s,t)=>{"use strict";t.d(s,{r:()=>a});var r=t(7577);function a(e,s,t){let{playNotificationSound:a}=function(){let e=(0,r.useRef)(null),s=(0,r.useRef)(0);return{playNotificationSound:(0,r.useCallback)(()=>{let t=Date.now();if(!(t-s.current<1e3)){s.current=t;try{e.current||(e.current=new(window.AudioContext||window.webkitAudioContext));let s=e.current;"suspended"===s.state&&s.resume();let t=s.createOscillator(),r=s.createGain();t.connect(r),r.connect(s.destination),t.frequency.setValueAtTime(880,s.currentTime),t.frequency.setValueAtTime(1047,s.currentTime+.1),t.type="sine",r.gain.setValueAtTime(0,s.currentTime),r.gain.linearRampToValueAtTime(.3,s.currentTime+.05),r.gain.linearRampToValueAtTime(.2,s.currentTime+.1),r.gain.linearRampToValueAtTime(.3,s.currentTime+.15),r.gain.linearRampToValueAtTime(0,s.currentTime+.3),t.start(s.currentTime),t.stop(s.currentTime+.3)}catch(e){console.log("[NotificationSound] Audio not available:",e)}}},[])}}();(0,r.useRef)(0),(0,r.useRef)(new Set),(0,r.useRef)(!0)}},1:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/root/webhook/ticket-console/src/app/dashboard/admin/ticket/[id]/page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,347,444,514,721],()=>t(903));module.exports=r})();