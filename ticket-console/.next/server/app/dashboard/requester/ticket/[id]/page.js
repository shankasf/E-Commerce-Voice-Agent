(()=>{var e={};e.id=816,e.ids=[816],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2521:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),s(4347),s(4968),s(5866);var r=s(3191),a=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["dashboard",{children:["requester",{children:["ticket",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4347)),"/root/webhook/ticket-console/src/app/dashboard/requester/ticket/[id]/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,4968)),"/root/webhook/ticket-console/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/root/webhook/ticket-console/src/app/dashboard/requester/ticket/[id]/page.tsx"],u="/dashboard/requester/ticket/[id]/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/requester/ticket/[id]/page",pathname:"/dashboard/requester/ticket/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4433:(e,t,s)=>{Promise.resolve().then(s.bind(s,7469))},7469:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(326),a=s(8853),n=s(5047),i=s(7577),l=s(8069),o=s(273),c=s(9179),d=s(9852),u=s(6333),x=s(3686);let m={Low:"bg-gray-100 text-gray-700",Medium:"bg-blue-100 text-blue-700",High:"bg-orange-100 text-orange-700",Critical:"bg-red-100 text-red-700"},g={Open:"bg-yellow-100 text-yellow-700","In Progress":"bg-blue-100 text-blue-700","Awaiting Customer":"bg-purple-100 text-purple-700",Escalated:"bg-orange-100 text-orange-700",Resolved:"bg-green-100 text-green-700",Closed:"bg-gray-100 text-gray-700"};function h(){let{user:e,isLoading:t}=(0,a.a)(),s=parseInt((0,n.useParams)().id),[h,p]=(0,i.useState)(null),[b,f]=(0,i.useState)([]),[y,j]=(0,i.useState)(""),[w,v]=(0,i.useState)(!0),[N,k]=(0,i.useState)(!1),[_,T]=(0,i.useState)(!1),C=(0,i.useRef)(null);(0,i.useRef)(0),(0,c.r)(b,e?.id,"requester");let q=(0,i.useCallback)(async()=>{if(e?.id&&s)try{let t=await l.UD.getTicketDetails(s,e.id);p(t)}catch(e){console.error("Error loading ticket:",e)}},[e?.id,s]),A=(0,i.useCallback)(async()=>{if(e?.id&&s)try{console.log("[Chat] Loading messages for ticket:",s);let t=await l.UD.getTicketMessages(s,e.id);f(t)}catch(e){console.error("Error loading messages:",e)}},[e?.id,s]),P=(0,i.useCallback)(async()=>{try{v(!0),await Promise.all([q(),A()])}finally{v(!1)}},[q,A]);(0,o.sU)(s,q,A);let R=async()=>{if(y.trim()&&!N)try{k(!0),h?.requires_human_agent||T(!0),await l.UD.addMessage(s,e.id,y),j(""),P()}catch(e){console.error("Error sending message:",e),T(!1)}finally{k(!1)}};if(t||!e)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."});if(w)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading ticket..."});if(!h)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-500 mb-4",children:"Ticket not found or access denied"}),r.jsx("button",{onClick:()=>window.history.back(),className:"text-blue-600 hover:text-blue-700",children:"Go back"})]})});let S=h.status?.name||"Unknown",$=h.priority?.name||"Medium",M=["Resolved","Closed"].includes(S);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[r.jsx("header",{className:"bg-white border-b border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[(0,r.jsxs)("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-3",children:[r.jsx(u.Z,{className:"w-4 h-4"}),"Back to tickets"]}),r.jsx("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["#",h.ticket_id]}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${g[S]}`,children:S}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${m[$]}`,children:$})]}),r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:h.subject}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Created ",(0,x.Q)(new Date(h.created_at),{addSuffix:!0})]})]})})]})}),h.description&&r.jsx("div",{className:"bg-white border-b border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),r.jsx("p",{className:"text-gray-700",children:h.description})]})}),r.jsx("div",{className:"flex-1 overflow-auto bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Conversation"}),r.jsx(d.uU,{messages:b,currentUserId:e.id,userRole:"requester",messagesEndRef:C,emptyMessage:"No messages yet. Start the conversation below.",aiThinking:_})]})}),!M&&r.jsx("div",{className:"bg-white border-t border-gray-200 shrink-0 shadow-lg",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:r.jsx(d.xg,{value:y,onChange:j,onSend:R,sending:N,placeholder:"Type your message...",accentColor:"blue"})})}),M&&r.jsx("div",{className:"bg-gray-100 border-t border-gray-200 shrink-0",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4 text-center text-gray-500",children:["This ticket is ",S.toLowerCase(),". You cannot add new messages."]})})]})}},9852:(e,t,s)=>{"use strict";s.d(t,{uU:()=>c,xg:()=>d});var r=s(326),a=s(732),n=s(9635),i=s(7506),l=s(5804);function o({message:e,currentUserId:t,userRole:s}){let i=!!e.sender_agent_id,o=i&&e.sender_agent?.agent_type==="Bot",c="requester"===s?e.sender_contact_id===t:e.sender_agent_id===t,d=c?"You":i?e.sender_agent?.full_name||"Support Agent":e.sender_contact?.full_name||"Customer",u=()=>o?"text-purple-600":i?"text-green-600":"text-blue-600";return(0,r.jsxs)("div",{className:`flex gap-3 ${c?"flex-row-reverse":""}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm ${o?"bg-purple-100":i?"bg-green-100":"bg-blue-100"}`,children:o?r.jsx(a.Z,{className:`w-5 h-5 ${u()}`}):r.jsx(n.Z,{className:`w-5 h-5 ${u()}`})}),(0,r.jsxs)("div",{className:`flex flex-col max-w-[75%] ${c?"items-end":"items-start"}`,children:[(0,r.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${c?"flex-row-reverse":""}`,children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:d}),r.jsx("span",{className:"text-xs text-gray-400",children:(0,l.WU)(new Date(e.message_time),"MMM d, h:mm a")}),o&&r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:`rounded-2xl px-4 py-2.5 shadow-sm ${c?"requester"===s?"bg-blue-600 text-white":"agent"===s?"bg-green-600 text-white":"bg-purple-600 text-white":"bg-white border border-gray-200 text-gray-700"} ${c?"rounded-tr-sm":"rounded-tl-sm"}`,children:r.jsx("div",{className:"whitespace-pre-wrap break-words leading-relaxed",children:o?function(e){let t=[],s=0;return e.split("\n").forEach((e,a)=>{let n;a>0&&t.push(r.jsx("br",{},`br-${s++}`));let i=[],l=0,o=/\*\*(.+?)\*\*|__(.+?)__/g;for(;null!==(n=o.exec(e));){n.index>l&&i.push(e.substring(l,n.index));let t=n[1]||n[2];i.push(r.jsx("strong",{className:"font-semibold",children:t},`bold-${s++}`)),l=n.index+n[0].length}l<e.length&&i.push(e.substring(l)),0===i.length?t.push(e):t.push(...i)}),t}(e.content):e.content})})]})]})}function c({messages:e,currentUserId:t,userRole:s,messagesEndRef:l,emptyMessage:c="No messages yet. Start the conversation below.",aiThinking:d=!1}){return 0===e.length?r.jsx("div",{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(n.Z,{className:"w-8 h-8 text-gray-400"})}),r.jsx("p",{className:"text-gray-500",children:c})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[e.map(e=>r.jsx(o,{message:e,currentUserId:t,userRole:s},e.message_id)),d&&(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm bg-purple-100",children:r.jsx(a.Z,{className:"w-5 h-5 text-purple-600"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"AI Assistant"}),r.jsx("span",{className:"text-xs bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-medium",children:"Bot"})]}),r.jsx("div",{className:"rounded-2xl rounded-tl-sm px-4 py-3 bg-white border border-gray-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[r.jsx(i.Z,{className:"w-4 h-4 animate-spin text-purple-600"}),r.jsx("span",{className:"text-sm",children:"AI is thinking..."})]})})]})]}),r.jsx("div",{ref:l})]})}function d({value:e,onChange:t,onSend:s,sending:a,placeholder:n="Type your message...",accentColor:i="blue"}){let l={blue:{focus:"focus:ring-blue-500 focus:border-blue-500",button:"bg-blue-600 hover:bg-blue-700"},green:{focus:"focus:ring-green-500 focus:border-green-500",button:"bg-green-600 hover:bg-green-700"},purple:{focus:"focus:ring-purple-500 focus:border-purple-500",button:"bg-purple-600 hover:bg-purple-700"}}[i];return(0,r.jsxs)("div",{className:"flex gap-3 items-end",children:[r.jsx("div",{className:"flex-1 relative",children:r.jsx("textarea",{value:e,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())},placeholder:n,rows:1,className:`w-full px-4 py-3 border border-gray-300 rounded-xl resize-none ${l.focus} focus:ring-2 transition-shadow`,style:{minHeight:"48px",maxHeight:"120px"}})}),r.jsx("button",{onClick:s,disabled:!e.trim()||a,className:`p-3 ${l.button} text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm`,children:a?r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}},9179:(e,t,s)=>{"use strict";s.d(t,{r:()=>a});var r=s(7577);function a(e,t,s){let{playNotificationSound:a}=function(){let e=(0,r.useRef)(null),t=(0,r.useRef)(0);return{playNotificationSound:(0,r.useCallback)(()=>{let s=Date.now();if(!(s-t.current<1e3)){t.current=s;try{e.current||(e.current=new(window.AudioContext||window.webkitAudioContext));let t=e.current;"suspended"===t.state&&t.resume();let s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.setValueAtTime(880,t.currentTime),s.frequency.setValueAtTime(1047,t.currentTime+.1),s.type="sine",r.gain.setValueAtTime(0,t.currentTime),r.gain.linearRampToValueAtTime(.3,t.currentTime+.05),r.gain.linearRampToValueAtTime(.2,t.currentTime+.1),r.gain.linearRampToValueAtTime(.3,t.currentTime+.15),r.gain.linearRampToValueAtTime(0,t.currentTime+.3),s.start(t.currentTime),s.stop(t.currentTime+.3)}catch(e){console.log("[NotificationSound] Audio not available:",e)}}},[])}}();(0,r.useRef)(0),(0,r.useRef)(new Set),(0,r.useRef)(!0)}},4347:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/root/webhook/ticket-console/src/app/dashboard/requester/ticket/[id]/page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,347,444,514,721],()=>s(2521));module.exports=r})();