exports.id=721,exports.ids=[721],exports.modules={7154:(t,e,i)=>{Promise.resolve().then(i.t.bind(i,2994,23)),Promise.resolve().then(i.t.bind(i,6114,23)),Promise.resolve().then(i.t.bind(i,9727,23)),Promise.resolve().then(i.t.bind(i,9671,23)),Promise.resolve().then(i.t.bind(i,1868,23)),Promise.resolve().then(i.t.bind(i,4759,23))},720:(t,e,i)=>{Promise.resolve().then(i.bind(i,1012))},1012:(t,e,i)=>{"use strict";i.d(e,{Providers:()=>n});var a=i(326),s=i(8853);function n({children:t}){return a.jsx(s.H,{children:t})}},8069:(t,e,i)=>{"use strict";i.d(e,{Sb:()=>n,UD:()=>s,fb:()=>r});var a=i(2777);let s={async getMyTickets(t){let{data:e,error:i}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name)
      `).eq("contact_id",t).order("created_at",{ascending:!1});if(i)throw i;return e||[]},async getTicketDetails(t,e){let{data:i,error:s}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name),
        contact:contact_id(full_name, email, phone)
      `).eq("ticket_id",t).eq("contact_id",e).single();return s?null:i},async getTicketMessages(t,e){if(!await this.getTicketDetails(t,e))return[];let{data:i,error:s}=await a.O.from("ticket_messages").select(`
        *,
        sender_agent:sender_agent_id(full_name, agent_type),
        sender_contact:sender_contact_id(full_name)
      `).eq("ticket_id",t).order("message_time",{ascending:!0});if(s)throw s;return i||[]},async createTicket(t,e,i,s,n=2){let{data:r,error:o}=await a.O.from("support_tickets").insert({contact_id:t,organization_id:e,subject:i,description:s,status_id:1,priority_id:n,requires_human_agent:!1}).select().single();if(o)throw o;return r&&fetch("/tms/api/ai-resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"assign",ticketId:r.ticket_id})}).catch(t=>console.log("AI bot auto-assignment failed:",t)),r},async addMessage(t,e,i){if(!await this.getTicketDetails(t,e))return null;let{data:s,error:n}=await a.O.from("ticket_messages").insert({ticket_id:t,sender_contact_id:e,content:i,message_type:"text"}).select().single();if(n)throw n;return fetch("/tms/api/ai-resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"respond",ticketId:t,userMessage:i})}).catch(t=>console.log("AI bot response not triggered:",t)),s},async getMyProfile(t){let{data:e,error:i}=await a.O.from("contacts").select("*, organization:organization_id(name, u_e_code)").eq("contact_id",t).single();return i?null:e}},n={async getAllTickets(t){let e=a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name),
        contact:contact_id(full_name, phone)
      `).order("created_at",{ascending:!1});t?.statusId&&(e=e.eq("status_id",t.statusId)),t?.priorityId&&(e=e.eq("priority_id",t.priorityId)),t?.organizationId&&(e=e.eq("organization_id",t.organizationId));let{data:i,error:s}=await e;if(s)throw s;return i||[]},async getTicketDetails(t){let{data:e,error:i}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name, u_e_code),
        contact:contact_id(full_name, email, phone)
      `).eq("ticket_id",t).single();return i?null:e},async getTicketMessages(t){let{data:e,error:i}=await a.O.from("ticket_messages").select(`
        *,
        sender_agent:sender_agent_id(full_name, agent_type),
        sender_contact:sender_contact_id(full_name)
      `).eq("ticket_id",t).order("message_time",{ascending:!0});if(i)throw i;return e||[]},async getOrganizations(){let{data:t,error:e}=await a.O.from("organizations").select("*").order("name");if(e)throw e;return t||[]},async getContacts(t){let e=a.O.from("contacts").select("*, organization:organization_id(name)").order("full_name");t&&(e=e.eq("organization_id",t));let{data:i,error:s}=await e;if(s)throw s;return i||[]},async getAgents(){let{data:t,error:e}=await a.O.from("support_agents").select("*").order("full_name");if(e)throw e;return t||[]},async createOrganization(t,e){let{data:i,error:s}=await a.O.from("organizations").insert({name:t,u_e_code:e}).select().single();if(s)throw s;return i},async createContact(t,e,i,s){let{data:n,error:r}=await a.O.from("contacts").insert({full_name:t,email:e,phone:i,organization_id:s}).select().single();if(r)throw r;return n},async createAgent(t,e,i,s){let{data:n,error:r}=await a.O.from("support_agents").insert({full_name:t,email:e,agent_type:i,specialization:s,is_available:!0}).select().single();if(r)throw r;return n},async updateTicketStatus(t,e){let i={status_id:e,updated_at:new Date().toISOString()};e>=5&&(i.closed_at=new Date().toISOString());let{error:s}=await a.O.from("support_tickets").update(i).eq("ticket_id",t);return!s},async assignTicket(t,e,i=!0){let{error:s}=await a.O.from("ticket_assignments").insert({ticket_id:t,support_agent_id:e,is_primary:i});return s||await this.updateTicketStatus(t,2),!s},async assignAIBot(t){try{let e=await fetch("/tms/api/ai-resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"assign",ticketId:t})});if(!e.ok){let t=await e.json();return{success:!1,error:t.message||"Failed to assign AI bot"}}let i=await e.json();return{success:!0,category:i.category}}catch(t){return{success:!1,error:"Network error"}}},async getAIBotStatus(t){try{let e=await fetch(`/tms/api/ai-resolve?ticketId=${t}`);if(!e.ok)return{hasAIBot:!1};return await e.json()}catch{return{hasAIBot:!1}}},async getDashboardStats(){let[t,e,i,s]=await Promise.all([a.O.from("support_tickets").select("status_id, priority_id"),a.O.from("organizations").select("organization_id"),a.O.from("contacts").select("contact_id"),a.O.from("support_agents").select("support_agent_id, is_available").eq("agent_type","Human")]),n=t.data||[];return{totalTickets:n.length,openTickets:n.filter(t=>1===t.status_id).length,inProgressTickets:n.filter(t=>2===t.status_id).length,escalatedTickets:n.filter(t=>4===t.status_id).length,criticalTickets:n.filter(t=>4===t.priority_id).length,totalOrganizations:(e.data||[]).length,totalContacts:(i.data||[]).length,totalAgents:(s.data||[]).length,availableAgents:(s.data||[]).filter(t=>t.is_available).length}}},r={async getAssignedTickets(t){let{data:e,error:i}=await a.O.from("ticket_assignments").select("ticket_id").eq("support_agent_id",t);if(i||!e?.length)return this.getEscalatedTickets();let s=e.map(t=>t.ticket_id),{data:n,error:r}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name),
        contact:contact_id(full_name, phone)
      `).in("ticket_id",s).order("priority_id",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;return n||[]},async getEscalatedTickets(){let{data:t,error:e}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name),
        contact:contact_id(full_name, phone)
      `).eq("status_id",4).order("priority_id",{ascending:!1}).order("created_at",{ascending:!1});if(e)throw e;return t||[]},async getHumanRequiredTickets(){let{data:t,error:e}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name),
        contact:contact_id(full_name, phone)
      `).eq("requires_human_agent",!0).in("status_id",[1,2,3,4]).order("priority_id",{ascending:!1}).order("created_at",{ascending:!1});if(e)throw e;return t||[]},async getTicketDetails(t,e){console.log("getTicketDetails called with ticketId:",t,"agentId:",e);let{data:i,error:s}=await a.O.from("support_tickets").select(`
        *,
        status:status_id(name),
        priority:priority_id(name),
        organization:organization_id(name, u_e_code),
        contact:contact_id(full_name, email, phone)
      `).eq("ticket_id",t).single();if(s)return console.error("Error fetching ticket:",s),null;if(console.log("Ticket data:",i),4===i.status_id||i.requires_human_agent)return console.log("Ticket is escalated or requires human - granting access"),i;let{data:n,error:r}=await a.O.from("ticket_assignments").select("assignment_id").eq("ticket_id",t).eq("support_agent_id",e).single();return(console.log("Assignment check:",{assignment:n,assignError:r,ticketId:t,agentId:e}),n)?console.log("Agent is assigned - granting access"):console.log("No specific access found, but granting access for demo"),i},async getTicketMessages(t,e){if(!await this.getTicketDetails(t,e))return[];let{data:i,error:s}=await a.O.from("ticket_messages").select(`
        *,
        sender_agent:sender_agent_id(full_name, agent_type),
        sender_contact:sender_contact_id(full_name)
      `).eq("ticket_id",t).order("message_time",{ascending:!0});if(s)throw s;return i||[]},async addMessage(t,e,i){if(!await this.getTicketDetails(t,e))return null;let{data:s,error:n}=await a.O.from("ticket_messages").insert({ticket_id:t,sender_agent_id:e,content:i,message_type:"text"}).select().single();if(n)throw n;return s},async updateTicketStatus(t,e,i){if(!await this.getTicketDetails(t,e))return!1;let s={status_id:i,updated_at:new Date().toISOString()};i>=5&&(s.closed_at=new Date().toISOString());let{error:n}=await a.O.from("support_tickets").update(s).eq("ticket_id",t);return!n},async claimTicket(t,e){let{error:i}=await a.O.from("ticket_assignments").insert({ticket_id:t,support_agent_id:e,is_primary:!0});return i||await this.updateTicketStatus(t,e,2),!i},async getMyProfile(t){let{data:e,error:i}=await a.O.from("support_agents").select("*").eq("support_agent_id",t).single();return i?null:e},async updateAvailability(t,e){let{error:i}=await a.O.from("support_agents").update({is_available:e}).eq("support_agent_id",t);return!i},async getDashboardStats(t){let e=await this.getAssignedTickets(t),i=await this.getEscalatedTickets(),a=await this.getHumanRequiredTickets();return{assignedTickets:e.length,escalatedTickets:i.length,humanRequiredTickets:a.length,criticalTickets:[...e,...i].filter(t=>4===t.priority_id).length}}}},8853:(t,e,i)=>{"use strict";i.d(e,{H:()=>o,a:()=>c});var a=i(326),s=i(7577);let n=(0,s.createContext)({user:null,login:()=>{},logout:()=>{},isLoading:!0}),r={requester:{role:"requester",id:1,name:"John Smith",email:"john.smith@acmecorp.com",organization_id:1},admin:{role:"admin",id:100,name:"Admin User",email:"admin@urackit.com"},agent:{role:"agent",id:2,name:"Alex Support",email:"alex@urackit.com"}};function o({children:t}){let[e,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[l,d]=(0,s.useState)(!1);return l?a.jsx(n.Provider,{value:{user:e,login:t=>{i(r[t])},logout:()=>{i(null)},isLoading:o},children:t}):a.jsx(a.Fragment,{children:t})}function c(){return(0,s.useContext)(n)}},2777:(t,e,i)=>{"use strict";let a;i.d(e,{O:()=>a});var s=i(5157);let n="https://wwdzxovkandfyohsfybm.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3ZHp4b3ZrYW5kZnlvaHNmeWJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTc3MjQyNiwiZXhwIjoyMDgxMzQ4NDI2fQ.D0dqV0ViOyv1xiNGqhzXlfz6TaCaDHibgkTGlSBVxIk";a=n&&r?(0,s.eI)(n,r,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,s.eI)("https://placeholder.supabase.co","placeholder-key")},273:(t,e,i)=>{"use strict";i.d(e,{im:()=>r,Po:()=>o,sU:()=>n});var a=i(7577);function s(t,e,i=[]){let{table:s,event:n="*",filter:r,enabled:o=!0}=t;(0,a.useRef)(e)}function n(t,e,i){let n=(0,a.useRef)(e),r=(0,a.useRef)(i);s({table:"support_tickets",filter:t?`ticket_id=eq.${t}`:void 0,enabled:!!t},()=>n.current(),[t]),s({table:"ticket_messages",filter:t?`ticket_id=eq.${t}`:void 0,enabled:!!t},()=>r.current(),[t])}function r(t){let e=(0,a.useRef)(t);s({table:"support_tickets"},()=>e.current(),[]),s({table:"ticket_assignments"},()=>e.current(),[])}function o(t,e){let i=(0,a.useRef)(e);s({table:"support_tickets",filter:t?`contact_id=eq.${t}`:void 0,enabled:!!t},()=>i.current(),[t])}i(2777)},4968:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>c,metadata:()=>o});var a=i(9510),s=i(5317),n=i.n(s);i(5023);let r=(0,i(8570).createProxy)(String.raw`/root/webhook/ticket-console/src/components/providers.tsx#Providers`),o={title:"U Rack IT - Ticket Management Console",description:"IT Support Ticket Management System"};function c({children:t}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:n().className,children:a.jsx(r,{children:t})})})}},5023:()=>{}};