generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Practice {
  practiceId        String            @id @default(dbgenerated("uuid_generate_v4()")) @map("practice_id") @db.Uuid
  name              String            @db.VarChar(255)
  practiceType      String?           @map("practice_type") @db.VarChar(100)
  phone             String?           @db.VarChar(20)
  fax               String?           @db.VarChar(20)
  email             String?           @db.VarChar(255)
  website           String?           @db.VarChar(255)
  addressLine1      String?           @map("address_line1") @db.VarChar(255)
  addressLine2      String?           @map("address_line2") @db.VarChar(255)
  city              String?           @db.VarChar(100)
  state             String?           @db.VarChar(50)
  zipCode           String?           @map("zip_code") @db.VarChar(20)
  timezone          String?           @default("America/New_York") @db.VarChar(50)
  officeHours       Json?             @map("office_hours")
  emergencyPhone    String?           @map("emergency_phone") @db.VarChar(20)
  npiNumber         String?           @map("npi_number") @db.VarChar(20)
  taxId             String?           @map("tax_id") @db.VarChar(20)
  logoUrl           String?           @map("logo_url")
  settings          Json?             @default("{}")
  createdAt         DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointments      Appointment[]
  callLogs          CallLog[]
  departments       Department[]
  insurancePlans    InsurancePlan[]
  invoices          Invoice[]
  patients          Patient[]
  providers         Provider[]
  serviceCategories ServiceCategory[]
  services          Service[]
  systemSettings    SystemSetting[]
  users             User[]
  waitlist          Waitlist[]

  @@map("practices")
}

model Department {
  departmentId   String     @id @default(dbgenerated("uuid_generate_v4()")) @map("department_id") @db.Uuid
  practiceId     String     @map("practice_id") @db.Uuid
  name           String     @db.VarChar(100)
  description    String?
  phoneExtension String?    @map("phone_extension") @db.VarChar(10)
  isActive       Boolean?   @default(true) @map("is_active")
  createdAt      DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  practice       Practice   @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  providers      Provider[]

  @@map("departments")
}

model Provider {
  providerId                 String             @id @default(dbgenerated("uuid_generate_v4()")) @map("provider_id") @db.Uuid
  practiceId                 String             @map("practice_id") @db.Uuid
  departmentId               String?            @map("department_id") @db.Uuid
  firstName                  String             @map("first_name") @db.VarChar(100)
  lastName                   String             @map("last_name") @db.VarChar(100)
  title                      String?            @db.VarChar(50)
  providerType               provider_type      @map("provider_type")
  specialization             String?            @db.VarChar(100)
  npiNumber                  String?            @map("npi_number") @db.VarChar(20)
  licenseNumber              String?            @map("license_number") @db.VarChar(50)
  licenseState               String?            @map("license_state") @db.VarChar(10)
  email                      String?            @db.VarChar(255)
  phone                      String?            @db.VarChar(20)
  bio                        String?
  photoUrl                   String?            @map("photo_url")
  acceptingNewPatients       Boolean?           @default(true) @map("accepting_new_patients")
  telehealthEnabled          Boolean?           @default(true) @map("telehealth_enabled")
  defaultAppointmentDuration Int?               @default(30) @map("default_appointment_duration")
  scheduleBuffer             Int?               @default(0) @map("schedule_buffer")
  isActive                   Boolean?           @default(true) @map("is_active")
  createdAt                  DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                  DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointments               Appointment[]
  callLogs                   CallLog[]
  medicalRecords             MedicalRecord[]
  preferredBy                Patient[]          @relation("PreferredProvider")
  prescriptions              Prescription[]
  schedules                  ProviderSchedule[]
  providerServices           ProviderService[]
  timeOff                    ProviderTimeOff[]
  department                 Department?        @relation(fields: [departmentId], references: [departmentId], onDelete: NoAction, onUpdate: NoAction)
  practice                   Practice           @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  waitlist                   Waitlist[]

  @@map("providers")
}

model ProviderSchedule {
  scheduleId  String    @id @default(dbgenerated("uuid_generate_v4()")) @map("schedule_id") @db.Uuid
  providerId  String    @map("provider_id") @db.Uuid
  dayOfWeek   Int       @map("day_of_week")
  startTime   DateTime  @map("start_time") @db.Time(6)
  endTime     DateTime  @map("end_time") @db.Time(6)
  isAvailable Boolean?  @default(true) @map("is_available")
  location    String?   @db.VarChar(255)
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  provider    Provider  @relation(fields: [providerId], references: [providerId], onDelete: Cascade, onUpdate: NoAction)

  @@map("provider_schedules")
}

model ProviderTimeOff {
  timeOffId  String    @id @default(dbgenerated("uuid_generate_v4()")) @map("time_off_id") @db.Uuid
  providerId String    @map("provider_id") @db.Uuid
  startDate  DateTime  @map("start_date") @db.Date
  endDate    DateTime  @map("end_date") @db.Date
  reason     String?   @db.VarChar(255)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  provider   Provider  @relation(fields: [providerId], references: [providerId], onDelete: Cascade, onUpdate: NoAction)

  @@map("provider_time_off")
}

model Patient {
  patientId                String             @id @default(dbgenerated("uuid_generate_v4()")) @map("patient_id") @db.Uuid
  practiceId               String             @map("practice_id") @db.Uuid
  mrn                      String?            @db.VarChar(50)
  firstName                String             @map("first_name") @db.VarChar(100)
  lastName                 String             @map("last_name") @db.VarChar(100)
  middleName               String?            @map("middle_name") @db.VarChar(100)
  preferredName            String?            @map("preferred_name") @db.VarChar(100)
  dateOfBirth              DateTime           @map("date_of_birth") @db.Date
  gender                   gender_type?
  ssnLastFour              String?            @map("ssn_last_four") @db.VarChar(4)
  email                    String?            @db.VarChar(255)
  phonePrimary             String?            @map("phone_primary") @db.VarChar(20)
  phoneSecondary           String?            @map("phone_secondary") @db.VarChar(20)
  phoneWork                String?            @map("phone_work") @db.VarChar(20)
  preferredContactMethod   String?            @default("phone") @map("preferred_contact_method") @db.VarChar(20)
  addressLine1             String?            @map("address_line1") @db.VarChar(255)
  addressLine2             String?            @map("address_line2") @db.VarChar(255)
  city                     String?            @db.VarChar(100)
  state                    String?            @db.VarChar(50)
  zipCode                  String?            @map("zip_code") @db.VarChar(20)
  emergencyContactName     String?            @map("emergency_contact_name") @db.VarChar(200)
  emergencyContactPhone    String?            @map("emergency_contact_phone") @db.VarChar(20)
  emergencyContactRelation String?            @map("emergency_contact_relationship") @db.VarChar(50)
  preferredLanguage        String?            @default("English") @map("preferred_language") @db.VarChar(50)
  preferredProviderId      String?            @map("preferred_provider_id") @db.Uuid
  primaryCareProvider      String?            @map("primary_care_provider") @db.VarChar(255)
  referringProvider        String?            @map("referring_provider") @db.VarChar(255)
  allergies                String[]
  medications              String[]
  medicalConditions        String[]           @map("medical_conditions")
  notes                    String?
  isActive                 Boolean?           @default(true) @map("is_active")
  portalAccess             Boolean?           @default(false) @map("portal_access")
  smsConsent               Boolean?           @default(true) @map("sms_consent")
  emailConsent             Boolean?           @default(true) @map("email_consent")
  hipaaConsentDate         DateTime?          @map("hipaa_consent_date") @db.Date
  createdAt                DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointments             Appointment[]
  callLogs                 CallLog[]
  invoices                 Invoice[]
  medicalRecords           MedicalRecord[]
  insurance                PatientInsurance[]
  practice                 Practice           @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  preferredProvider        Provider?          @relation("PreferredProvider", fields: [preferredProviderId], references: [providerId], onDelete: NoAction, onUpdate: NoAction)
  payments                 Payment[]
  prescriptions            Prescription[]
  waitlist                 Waitlist[]

  @@index([phonePrimary], map: "idx_patients_phone_primary")
  @@index([phoneSecondary], map: "idx_patients_phone_secondary")
  @@index([email], map: "idx_patients_email")
  @@index([dateOfBirth], map: "idx_patients_dob")
  @@index([lastName, firstName], map: "idx_patients_name")
  @@map("patients")
}

model InsurancePlan {
  planId           String             @id @default(dbgenerated("uuid_generate_v4()")) @map("plan_id") @db.Uuid
  practiceId       String?            @map("practice_id") @db.Uuid
  payerName        String             @map("payer_name") @db.VarChar(255)
  payerId          String?            @map("payer_id") @db.VarChar(50)
  planName         String?            @map("plan_name") @db.VarChar(255)
  planType         String?            @map("plan_type") @db.VarChar(50)
  phone            String?            @db.VarChar(20)
  fax              String?            @db.VarChar(20)
  website          String?            @db.VarChar(255)
  claimsAddress    String?            @map("claims_address")
  isActive         Boolean?           @default(true) @map("is_active")
  createdAt        DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  practice         Practice?          @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  patientInsurance PatientInsurance[]

  @@map("insurance_plans")
}

model PatientInsurance {
  patientInsuranceId String            @id @default(dbgenerated("uuid_generate_v4()")) @map("patient_insurance_id") @db.Uuid
  patientId          String            @map("patient_id") @db.Uuid
  planId             String?           @map("plan_id") @db.Uuid
  insuranceType      String?           @default("primary") @map("insurance_type") @db.VarChar(20)
  payerName          String            @map("payer_name") @db.VarChar(255)
  planName           String?           @map("plan_name") @db.VarChar(255)
  memberId           String            @map("member_id") @db.VarChar(100)
  groupNumber        String?           @map("group_number") @db.VarChar(100)
  subscriberName     String?           @map("subscriber_name") @db.VarChar(200)
  subscriberDob      DateTime?         @map("subscriber_dob") @db.Date
  subscriberRelation String?           @map("subscriber_relationship") @db.VarChar(50)
  effectiveDate      DateTime?         @map("effective_date") @db.Date
  terminationDate    DateTime?         @map("termination_date") @db.Date
  copayAmount        Decimal?          @map("copay_amount") @db.Decimal(10, 2)
  deductibleAmount   Decimal?          @map("deductible_amount") @db.Decimal(10, 2)
  deductibleMet      Decimal?          @default(0) @map("deductible_met") @db.Decimal(10, 2)
  outOfPocketMax     Decimal?          @map("out_of_pocket_max") @db.Decimal(10, 2)
  outOfPocketMet     Decimal?          @default(0) @map("out_of_pocket_met") @db.Decimal(10, 2)
  coveragePercentage Int?              @default(80) @map("coverage_percentage")
  priorAuthRequired  Boolean?          @default(false) @map("prior_auth_required")
  verificationStatus insurance_status? @default(pending) @map("verification_status")
  lastVerifiedAt     DateTime?         @map("last_verified_at") @db.Timestamptz(6)
  verificationNotes  String?           @map("verification_notes")
  cardFrontUrl       String?           @map("card_front_url")
  cardBackUrl        String?           @map("card_back_url")
  isActive           Boolean?          @default(true) @map("is_active")
  createdAt          DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient            Patient           @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  plan               InsurancePlan?    @relation(fields: [planId], references: [planId], onDelete: NoAction, onUpdate: NoAction)

  @@index([memberId], map: "idx_patient_insurance_member")
  @@index([patientId], map: "idx_patient_insurance_patient")
  @@map("patient_insurance")
}

model ServiceCategory {
  categoryId   String    @id @default(dbgenerated("uuid_generate_v4()")) @map("category_id") @db.Uuid
  practiceId   String    @map("practice_id") @db.Uuid
  name         String    @db.VarChar(100)
  description  String?
  displayOrder Int?      @default(0) @map("display_order")
  isActive     Boolean?  @default(true) @map("is_active")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  practice     Practice  @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  services     Service[]

  @@map("service_categories")
}

model Service {
  serviceId               String            @id @default(dbgenerated("uuid_generate_v4()")) @map("service_id") @db.Uuid
  practiceId              String            @map("practice_id") @db.Uuid
  categoryId              String?           @map("category_id") @db.Uuid
  code                    String?           @db.VarChar(20)
  name                    String            @db.VarChar(255)
  description             String?
  duration                Int?              @default(30)
  price                   Decimal?          @db.Decimal(10, 2)
  insuranceBillable       Boolean?          @default(true) @map("insurance_billable")
  requiresPriorAuth       Boolean?          @default(false) @map("requires_prior_auth")
  preparationInstructions String?           @map("preparation_instructions")
  aftercareInstructions   String?           @map("aftercare_instructions")
  isActive                Boolean?          @default(true) @map("is_active")
  createdAt               DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointments            Appointment[]
  providerServices        ProviderService[]
  category                ServiceCategory?  @relation(fields: [categoryId], references: [categoryId], onDelete: NoAction, onUpdate: NoAction)
  practice                Practice          @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  waitlist                Waitlist[]

  @@index([code], map: "idx_services_code")
  @@map("services")
}

model ProviderService {
  providerServiceId String   @id @default(dbgenerated("uuid_generate_v4()")) @map("provider_service_id") @db.Uuid
  providerId        String   @map("provider_id") @db.Uuid
  serviceId         String   @map("service_id") @db.Uuid
  customDuration    Int?     @map("custom_duration")
  customPrice       Decimal? @map("custom_price") @db.Decimal(10, 2)
  isActive          Boolean? @default(true) @map("is_active")
  provider          Provider @relation(fields: [providerId], references: [providerId], onDelete: Cascade, onUpdate: NoAction)
  service           Service  @relation(fields: [serviceId], references: [serviceId], onDelete: Cascade, onUpdate: NoAction)

  @@unique([providerId, serviceId])
  @@map("provider_services")
}

model Appointment {
  appointmentId                                                       String                @id @default(dbgenerated("uuid_generate_v4()")) @map("appointment_id") @db.Uuid
  practiceId                                                          String                @map("practice_id") @db.Uuid
  patientId                                                           String                @map("patient_id") @db.Uuid
  providerId                                                          String                @map("provider_id") @db.Uuid
  serviceId                                                           String?               @map("service_id") @db.Uuid
  appointmentType                                                     appointment_type      @default(routine_checkup) @map("appointment_type")
  status                                                              appointment_status    @default(scheduled)
  scheduledDate                                                       DateTime              @map("scheduled_date") @db.Date
  scheduledTime                                                       DateTime              @map("scheduled_time") @db.Time(6)
  endTime                                                             DateTime?             @map("end_time") @db.Time(6)
  duration                                                            Int                   @default(30)
  room                                                                String?               @db.VarChar(50)
  chiefComplaint                                                      String?               @map("chief_complaint")
  notes                                                               String?
  internalNotes                                                       String?               @map("internal_notes")
  isRecurring                                                         Boolean?              @default(false) @map("is_recurring")
  recurringPattern                                                    Json?                 @map("recurring_pattern")
  parentAppointmentId                                                 String?               @map("parent_appointment_id") @db.Uuid
  confirmationSent                                                    Boolean?              @default(false) @map("confirmation_sent")
  confirmationSentAt                                                  DateTime?             @map("confirmation_sent_at") @db.Timestamptz(6)
  reminderSent                                                        Boolean?              @default(false) @map("reminder_sent")
  reminderSentAt                                                      DateTime?             @map("reminder_sent_at") @db.Timestamptz(6)
  checkedInAt                                                         DateTime?             @map("checked_in_at") @db.Timestamptz(6)
  startedAt                                                           DateTime?             @map("started_at") @db.Timestamptz(6)
  completedAt                                                         DateTime?             @map("completed_at") @db.Timestamptz(6)
  cancelledAt                                                         DateTime?             @map("cancelled_at") @db.Timestamptz(6)
  cancellationReason                                                  String?               @map("cancellation_reason")
  rescheduledFromId                                                   String?               @map("rescheduled_from_id") @db.Uuid
  rescheduledToId                                                     String?               @map("rescheduled_to_id") @db.Uuid
  telehealthLink                                                      String?               @map("telehealth_link")
  createdBy                                                           String?               @map("created_by") @db.VarChar(100)
  createdVia                                                          String?               @default("phone") @map("created_via") @db.VarChar(50)
  createdAt                                                           DateTime?             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                                                           DateTime?             @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  reminders                                                           AppointmentReminder[]
  appointments_appointments_parent_appointment_idToappointments       Appointment?          @relation("appointments_parent_appointment_idToappointments", fields: [parentAppointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  other_appointments_appointments_parent_appointment_idToappointments Appointment[]         @relation("appointments_parent_appointment_idToappointments")
  patient                                                             Patient               @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  practice                                                            Practice              @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  provider                                                            Provider              @relation(fields: [providerId], references: [providerId], onDelete: Cascade, onUpdate: NoAction)
  appointments_appointments_rescheduled_from_idToappointments         Appointment?          @relation("appointments_rescheduled_from_idToappointments", fields: [rescheduledFromId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  other_appointments_appointments_rescheduled_from_idToappointments   Appointment[]         @relation("appointments_rescheduled_from_idToappointments")
  appointments_appointments_rescheduled_to_idToappointments           Appointment?          @relation("appointments_rescheduled_to_idToappointments", fields: [rescheduledToId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  other_appointments_appointments_rescheduled_to_idToappointments     Appointment[]         @relation("appointments_rescheduled_to_idToappointments")
  service                                                             Service?              @relation(fields: [serviceId], references: [serviceId], onDelete: NoAction, onUpdate: NoAction)
  callLogs                                                            CallLog[]
  invoices                                                            Invoice[]
  medicalRecord                                                       MedicalRecord[]
  prescriptions                                                       Prescription[]
  waitlist                                                            Waitlist[]

  @@index([scheduledDate], map: "idx_appointments_date")
  @@index([patientId], map: "idx_appointments_patient")
  @@index([providerId], map: "idx_appointments_provider")
  @@index([status], map: "idx_appointments_status")
  @@index([providerId, scheduledDate], map: "idx_appointments_provider_date")
  @@map("appointments")
}

model AppointmentReminder {
  reminderId     String           @id @default(dbgenerated("uuid_generate_v4()")) @map("reminder_id") @db.Uuid
  appointmentId  String           @map("appointment_id") @db.Uuid
  reminderType   reminder_type    @default(appointment) @map("reminder_type")
  channel        String           @db.VarChar(20)
  scheduledFor   DateTime         @map("scheduled_for") @db.Timestamptz(6)
  sentAt         DateTime?        @map("sent_at") @db.Timestamptz(6)
  status         reminder_status? @default(pending)
  messageContent String?          @map("message_content")
  response       String?
  respondedAt    DateTime?        @map("responded_at") @db.Timestamptz(6)
  createdAt      DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  appointment    Appointment      @relation(fields: [appointmentId], references: [appointmentId], onDelete: Cascade, onUpdate: NoAction)

  @@map("appointment_reminders")
}

model Waitlist {
  waitlistId             String       @id @default(dbgenerated("uuid_generate_v4()")) @map("waitlist_id") @db.Uuid
  practiceId             String       @map("practice_id") @db.Uuid
  patientId              String       @map("patient_id") @db.Uuid
  providerId             String?      @map("provider_id") @db.Uuid
  serviceId              String?      @map("service_id") @db.Uuid
  preferredDates         Json?        @map("preferred_dates")
  preferredTimes         Json?        @map("preferred_times")
  flexibility            String?      @default("flexible") @db.VarChar(20)
  urgency                String?      @default("normal") @db.VarChar(20)
  notes                  String?
  status                 String?      @default("active") @db.VarChar(20)
  contactedAt            DateTime?    @map("contacted_at") @db.Timestamptz(6)
  scheduledAppointmentId String?      @map("scheduled_appointment_id") @db.Uuid
  createdAt              DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt              DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient                Patient      @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  practice               Practice     @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  providers              Provider?    @relation(fields: [providerId], references: [providerId], onDelete: NoAction, onUpdate: NoAction)
  appointments           Appointment? @relation(fields: [scheduledAppointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  services               Service?     @relation(fields: [serviceId], references: [serviceId], onDelete: NoAction, onUpdate: NoAction)

  @@map("waitlist")
}

model MedicalRecord {
  recordId              String       @id @default(dbgenerated("uuid_generate_v4()")) @map("record_id") @db.Uuid
  patientId             String       @map("patient_id") @db.Uuid
  appointmentId         String?      @map("appointment_id") @db.Uuid
  providerId            String?      @map("provider_id") @db.Uuid
  recordDate            DateTime     @default(dbgenerated("CURRENT_DATE")) @map("record_date") @db.Date
  recordType            String?      @map("record_type") @db.VarChar(50)
  chiefComplaint        String?      @map("chief_complaint")
  diagnosisCodes        String[]     @map("diagnosis_codes")
  diagnosisDescriptions String[]     @map("diagnosis_descriptions")
  treatmentNotes        String?      @map("treatment_notes")
  prescriptionsGiven    Json?        @map("prescriptions_given")
  followUpRequired      Boolean?     @default(false) @map("follow_up_required")
  followUpTimeframe     String?      @map("follow_up_timeframe") @db.VarChar(50)
  referrals             Json?
  vitals                Json?
  isConfidential        Boolean?     @default(false) @map("is_confidential")
  createdAt             DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointment           Appointment? @relation(fields: [appointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  patient               Patient      @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  provider              Provider?    @relation(fields: [providerId], references: [providerId], onDelete: NoAction, onUpdate: NoAction)

  @@index([patientId], map: "idx_medical_records_patient")
  @@map("medical_records")
}

model Prescription {
  prescriptionId     String       @id @default(dbgenerated("uuid_generate_v4()")) @map("prescription_id") @db.Uuid
  patientId          String       @map("patient_id") @db.Uuid
  providerId         String       @map("provider_id") @db.Uuid
  appointmentId      String?      @map("appointment_id") @db.Uuid
  medicationName     String       @map("medication_name") @db.VarChar(255)
  dosage             String?      @db.VarChar(100)
  frequency          String?      @db.VarChar(100)
  quantity           Int?
  refillsAllowed     Int?         @default(0) @map("refills_allowed")
  refillsRemaining   Int?         @default(0) @map("refills_remaining")
  pharmacyName       String?      @map("pharmacy_name") @db.VarChar(255)
  pharmacyPhone      String?      @map("pharmacy_phone") @db.VarChar(20)
  pharmacyAddress    String?      @map("pharmacy_address")
  prescribedDate     DateTime     @default(dbgenerated("CURRENT_DATE")) @map("prescribed_date") @db.Date
  startDate          DateTime?    @map("start_date") @db.Date
  endDate            DateTime?    @map("end_date") @db.Date
  instructions       String?
  isControlled       Boolean?     @default(false) @map("is_controlled")
  status             String?      @default("active") @db.VarChar(20)
  discontinuedReason String?      @map("discontinued_reason")
  lastFilledDate     DateTime?    @map("last_filled_date") @db.Date
  nextRefillDate     DateTime?    @map("next_refill_date") @db.Date
  createdAt          DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointment        Appointment? @relation(fields: [appointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  patient            Patient      @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  provider           Provider     @relation(fields: [providerId], references: [providerId], onDelete: NoAction, onUpdate: NoAction)

  @@index([patientId], map: "idx_prescriptions_patient")
  @@map("prescriptions")
}

model Invoice {
  invoiceId             String       @id @default(dbgenerated("uuid_generate_v4()")) @map("invoice_id") @db.Uuid
  practiceId            String       @map("practice_id") @db.Uuid
  patientId             String       @map("patient_id") @db.Uuid
  appointmentId         String?      @map("appointment_id") @db.Uuid
  invoiceNumber         String?      @unique @map("invoice_number") @db.VarChar(50)
  invoiceDate           DateTime     @default(dbgenerated("CURRENT_DATE")) @map("invoice_date") @db.Date
  dueDate               DateTime?    @map("due_date") @db.Date
  subtotal              Decimal      @default(0) @db.Decimal(10, 2)
  insuranceAdjustment   Decimal?     @default(0) @map("insurance_adjustment") @db.Decimal(10, 2)
  insurancePayment      Decimal?     @default(0) @map("insurance_payment") @db.Decimal(10, 2)
  patientResponsibility Decimal?     @default(0) @map("patient_responsibility") @db.Decimal(10, 2)
  amountPaid            Decimal?     @default(0) @map("amount_paid") @db.Decimal(10, 2)
  balanceDue            Decimal?     @default(0) @map("balance_due") @db.Decimal(10, 2)
  status                String?      @default("pending") @db.VarChar(20)
  notes                 String?
  createdAt             DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  appointment           Appointment? @relation(fields: [appointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  patient               Patient      @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)
  practice              Practice     @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  payments              Payment[]

  @@index([patientId], map: "idx_invoices_patient")
  @@index([status], map: "idx_invoices_status")
  @@map("invoices")
}

model Payment {
  paymentId       String    @id @default(dbgenerated("uuid_generate_v4()")) @map("payment_id") @db.Uuid
  invoiceId       String?   @map("invoice_id") @db.Uuid
  patientId       String    @map("patient_id") @db.Uuid
  amount          Decimal   @db.Decimal(10, 2)
  paymentMethod   String?   @map("payment_method") @db.VarChar(50)
  paymentDate     DateTime  @default(dbgenerated("CURRENT_DATE")) @map("payment_date") @db.Date
  referenceNumber String?   @map("reference_number") @db.VarChar(100)
  notes           String?
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  invoice         Invoice?  @relation(fields: [invoiceId], references: [invoiceId], onDelete: Cascade, onUpdate: NoAction)
  patient         Patient   @relation(fields: [patientId], references: [patientId], onDelete: Cascade, onUpdate: NoAction)

  @@map("payments")
}

model CallLog {
  logId             String             @id @default(dbgenerated("uuid_generate_v4()")) @map("log_id") @db.Uuid
  practiceId        String?            @map("practice_id") @db.Uuid
  callSid           String?            @map("call_sid") @db.VarChar(100)
  sessionId         String?            @map("session_id") @db.VarChar(100)
  phoneFrom         String?            @map("phone_from") @db.VarChar(20)
  phoneTo           String?            @map("phone_to") @db.VarChar(20)
  direction         call_direction
  status            call_status?       @default(in_progress)
  patientId         String?            @map("patient_id") @db.Uuid
  providerId        String?            @map("provider_id") @db.Uuid
  agentType         String?            @map("agent_type") @db.VarChar(50)
  callReason        String?            @map("call_reason") @db.VarChar(100)
  appointmentId     String?            @map("appointment_id") @db.Uuid
  durationSeconds   Int?               @map("duration_seconds")
  transcript        String?
  callSummary       String?            @map("call_summary")
  sentiment         String?            @db.VarChar(20)
  resolutionStatus  String?            @map("resolution_status") @db.VarChar(50)
  followUpRequired  Boolean?           @default(false) @map("follow_up_required")
  followUpNotes     String?            @map("follow_up_notes")
  recordingUrl      String?            @map("recording_url")
  startedAt         DateTime?          @default(now()) @map("started_at") @db.Timestamptz(6)
  endedAt           DateTime?          @map("ended_at") @db.Timestamptz(6)
  createdAt         DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  agentInteractions AgentInteraction[]
  analytics         CallLogAnalytics?
  appointment       Appointment?       @relation(fields: [appointmentId], references: [appointmentId], onDelete: NoAction, onUpdate: NoAction)
  patient           Patient?           @relation(fields: [patientId], references: [patientId], onDelete: NoAction, onUpdate: NoAction)
  practice          Practice?          @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)
  provider          Provider?          @relation(fields: [providerId], references: [providerId], onDelete: NoAction, onUpdate: NoAction)

  @@index([phoneFrom], map: "idx_call_logs_phone")
  @@index([patientId], map: "idx_call_logs_patient")
  @@index([sessionId], map: "idx_call_logs_session")
  @@map("call_logs")
}

model CallLogAnalytics {
  id                  String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  logId               String   @unique @map("log_id") @db.Uuid
  sentimentLabel      String?  @map("sentiment_label") @db.VarChar(20)
  sentimentScore      Float?   @map("sentiment_score") @db.Real
  leadClassification  String?  @map("lead_classification") @db.VarChar(20)
  leadScore           Int?     @map("lead_score")
  intent              String?  @db.VarChar(50)
  keyTopics           Json?    @default("[]") @map("key_topics") @db.JsonB
  patientSatisfaction Int?     @map("patient_satisfaction")
  escalationRequired  Boolean? @default(false) @map("escalation_required")
  escalationReason    String?  @map("escalation_reason")
  aiSummary           String?  @map("ai_summary")
  analyzedAt          DateTime? @default(now()) @map("analyzed_at") @db.Timestamptz(6)
  callLog             CallLog  @relation(fields: [logId], references: [logId], onDelete: Cascade)

  @@map("call_log_analytics")
}

model AgentInteraction {
  interactionId  String    @id @default(dbgenerated("uuid_generate_v4()")) @map("interaction_id") @db.Uuid
  callLogId      String?   @map("call_log_id") @db.Uuid
  sessionId      String?   @map("session_id") @db.VarChar(100)
  agentName      String    @map("agent_name") @db.VarChar(100)
  startedAt      DateTime? @default(now()) @map("started_at") @db.Timestamptz(6)
  endedAt        DateTime? @map("ended_at") @db.Timestamptz(6)
  transferredTo  String?   @map("transferred_to") @db.VarChar(100)
  transferReason String?   @map("transfer_reason")
  toolsUsed      String[]  @map("tools_used")
  actionsTaken   Json?     @map("actions_taken")
  outcome        String?   @db.VarChar(100)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  callLog        CallLog?  @relation(fields: [callLogId], references: [logId], onDelete: Cascade, onUpdate: NoAction)

  @@map("agent_interactions")
}

model SystemSetting {
  settingId    String    @id @default(dbgenerated("uuid_generate_v4()")) @map("setting_id") @db.Uuid
  practiceId   String?   @map("practice_id") @db.Uuid
  settingKey   String    @map("setting_key") @db.VarChar(100)
  settingValue Json?     @map("setting_value")
  description  String?
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  practice     Practice? @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)

  @@unique([practiceId, settingKey])
  @@map("system_settings")
}

model User {
  userId       String    @id @default(dbgenerated("uuid_generate_v4()")) @map("user_id") @db.Uuid
  practiceId   String    @map("practice_id") @db.Uuid
  email        String    @unique @db.VarChar(255)
  passwordHash String    @map("password_hash") @db.VarChar(255)
  firstName    String    @map("first_name") @db.VarChar(100)
  lastName     String    @map("last_name") @db.VarChar(100)
  role         user_role @default(staff)
  phone        String?   @db.VarChar(20)
  isActive     Boolean?  @default(true) @map("is_active")
  lastLoginAt  DateTime? @map("last_login_at") @db.Timestamptz(6)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  practice     Practice  @relation(fields: [practiceId], references: [practiceId], onDelete: Cascade, onUpdate: NoAction)

  @@index([email], map: "idx_users_email")
  @@index([practiceId], map: "idx_users_practice")
  @@map("users")
}

enum appointment_status {
  scheduled
  confirmed
  checked_in
  in_progress
  completed
  cancelled
  no_show
  rescheduled
}

enum appointment_type {
  new_patient
  follow_up
  routine_checkup
  emergency
  consultation
  procedure
  telehealth
}

enum call_direction {
  inbound
  outbound
}

enum call_status {
  in_progress
  completed
  missed
  voicemail
  failed
}

enum gender_type {
  male
  female
  other
  prefer_not_to_say
}

enum insurance_status {
  pending
  verified
  failed
  expired
  not_covered
}

enum provider_type {
  doctor
  dentist
  specialist
  nurse_practitioner
  physician_assistant
  hygienist
  therapist
}

enum reminder_status {
  pending
  sent
  delivered
  acknowledged
  failed
}

enum reminder_type {
  appointment
  follow_up
  prescription_refill
  annual_checkup
  payment_due
}

enum user_role {
  admin
  staff
  provider
  patient
}
